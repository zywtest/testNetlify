/**
 * --------------------------------------------------------------------------------------------------------------
 * checkbox settings
 * --------------------------------------------------------------------------------------------------------------
 */
attackBar = [
  attackType1 =         document.querySelector('#attackType1'),
  attackType2 =         document.querySelector('#attackType2'),
  attackType3 =         document.querySelector('#attackType3'),
];
defenseBar = [
  defenseType1 =        document.querySelector('#defenseType1'),
  defenseType2 =        document.querySelector('#defenseType2'),
  defenseType3 =        document.querySelector('#defenseType3'),
  defenseType4 =        document.querySelector('#defenseType4'),
  defenseType5 =        document.querySelector('#defenseType5'),
];
sideStepBar = [
  sidestepType1 =       document.querySelector('#sidestepType1'),
  sidestepType2 =       document.querySelector('#sidestepType2'),
  sidestepType3 =       document.querySelector('#sidestepType3'),
  sidestepType4 =       document.querySelector('#sidestepType4'),
  sidestepType5 =       document.querySelector('#sidestepType5'),
  sidestepType6 =       document.querySelector('#sidestepType6'),
];
invincibleBar = [
  invincibleType1 =     document.querySelector('#invincibleType1'),
  invincibleType2 =     document.querySelector('#invincibleType2'),
  invincibleType3 =     document.querySelector('#invincibleType3'),
  invincibleType4 =     document.querySelector('#invincibleType4'),
  invincibleType5 =     document.querySelector('#invincibleType5'),
  invincibleType6 =     document.querySelector('#invincibleType6'),
];
createStarBar = [
  createStarType1 =     document.querySelector('#createStarType1'),
  createStarType2 =     document.querySelector('#createStarType2'),
  createStarType3 =     document.querySelector('#createStarType3'),
  createStarType4 =     document.querySelector('#createStarType4'),
];
starDropBar = [
  starDropType1 =       document.querySelector('#starDropType1'),
  starDropType2 =       document.querySelector('#starDropType2'),
  starDropType3 =       document.querySelector('#starDropType3'),
];
starGatherBar = [
  starGatherType1 =     document.querySelector('#starGatherType1'),
  starGatherType2 =     document.querySelector('#starGatherType2'),
  starGatherType3 =     document.querySelector('#starGatherType3'),
  starGatherType4 =     document.querySelector('#starGatherType4'),
  starGatherType5 =     document.querySelector('#starGatherType5'),
  starGatherType6 =     document.querySelector('#starGatherType6'),
  starGatherType7 =     document.querySelector('#starGatherType7'),
  starGatherType8 =     document.querySelector('#starGatherType8'),
  starGatherType9 =     document.querySelector('#starGatherType9'),
  starGatherType10 =     document.querySelector('#starGatherType10'),
  starGatherType11 =     document.querySelector('#starGatherType11'),
  starGatherType12 =     document.querySelector('#starGatherType12'),
  starGatherType13 =     document.querySelector('#starGatherType13'),
  starGatherType14 =     document.querySelector('#starGatherType14'),
  starGatherType15 =     document.querySelector('#starGatherType15'),
];
criticalBar =[
  criticalType1 =       document.querySelector('#criticalType1'),
  criticalType2 =       document.querySelector('#criticalType2'),
  criticalType3 =       document.querySelector('#criticalType3'),
  criticalType4 =       document.querySelector('#criticalType4'),
  criticalType5 =       document.querySelector('#criticalType5'),
];
quickBar = [
  quickType1 =          document.querySelector('#quickType1'),
  quickType2 =          document.querySelector('#quickType2'),
  quickType3 =          document.querySelector('#quickType3'),
  quickType4 =          document.querySelector('#quickType4'),
  quickType5 =          document.querySelector('#quickType5'),
];
artsBar = [
  artsType1 =           document.querySelector('#artsType1'),
  artsType2 =           document.querySelector('#artsType2'),
  artsType3 =           document.querySelector('#artsType3'),
  artsType4 =           document.querySelector('#artsType4'),
  artsType5 =           document.querySelector('#artsType5'),
];
busterBar = [
  busterType1 =          document.querySelector('#busterType1'),
  busterType2 =          document.querySelector('#busterType2'),
  busterType3 =          document.querySelector('#busterType3'),
  busterType4 =          document.querySelector('#busterType4'),
  busterType5 =          document.querySelector('#busterType5'),
];
npChargeBar = [
  npChargeType1 =       document.querySelector('#npChargeType1'),
  npChargeType2 =       document.querySelector('#npChargeType2'),
  npChargeType3 =       document.querySelector('#npChargeType3'),
  npChargeType4 =       document.querySelector('#npChargeType4'),
  npChargeType5 =       document.querySelector('#npChargeType5'),
  npChargeType6 =       document.querySelector('#npChargeType6'),
];
npUpBar = [
  npUpType1 =           document.querySelector('#npUpType1'),
  npUpType2 =           document.querySelector('#npUpType2'),
  npUpType3 =           document.querySelector('#npUpType3'),
  npUpType4 =           document.querySelector('#npUpType4'),
  npUpType5 =           document.querySelector('#npUpType5'),
  npUpType6 =           document.querySelector('#npUpType6'),
];
phantasmBar = [
  phantasmType1 =       document.querySelector('#phantasmType1'),
  phantasmType2 =       document.querySelector('#phantasmType2'),
  phantasmType3 =       document.querySelector('#phantasmType3'),
  phantasmType4 =       document.querySelector('#phantasmType4'),
  phantasmType5 =       document.querySelector('#phantasmType5'),
  phantasmType6 =       document.querySelector('#phantasmType6'),
];
inflictDeathBar = [
  inflictDeathType1 =   document.querySelector('#inflictDeathType1'),
  inflictDeathType2 =   document.querySelector('#inflictDeathType2'),
  inflictDeathType3 =   document.querySelector('#inflictDeathType3'),
  inflictDeathType4 =   document.querySelector('#inflictDeathType4'),
  inflictDeathType5 =   document.querySelector('#inflictDeathType5'),
];
debuffBar = [
  debuffType1 =         document.querySelector('#debuffType1'),
  debuffType2 =         document.querySelector('#debuffType2'),
  debuffType3 =         document.querySelector('#debuffType3'),
  debuffType4 =         document.querySelector('#debuffType4'),
  debuffType5 =         document.querySelector('#debuffType5'),
];
cleanseBar = [
  cleanseType1 =        document.querySelector('#cleanseType1'),
  cleanseType2 =        document.querySelector('#cleanseType2'),
  cleanseType3 =        document.querySelector('#cleanseType3'),
];
buffRemoveBar = [
  buffRemoveType1 =     document.querySelector('#buffRemoveType1'),
  buffRemoveType2 =     document.querySelector('#buffRemoveType2'),
  buffRemoveType3 =     document.querySelector('#buffRemoveType3'),
  buffRemoveType4 =     document.querySelector('#buffRemoveType4'),
  buffRemoveType5 =     document.querySelector('#buffRemoveType5'),
  buffRemoveType6 =     document.querySelector('#buffRemoveType6'),
  buffRemoveType7 =     document.querySelector('#buffRemoveType7'),
  buffRemoveType8 =     document.querySelector('#buffRemoveType8'),
]
dotBar = [
  dotType1 =            document.querySelector('#dotType1'),
  dotType2 =            document.querySelector('#dotType2'),
  dotType3 =            document.querySelector('#dotType3'),
  dotType4 =            document.querySelector('#dotType4'),
  dotType5 =            document.querySelector('#dotType5'),
  dotType6 =            document.querySelector('#dotType6'),
]
controllBar = [
  controllType1 =       document.querySelector('#controllType1'),
  controllType2 =       document.querySelector('#controllType2'),
  controllType3 =       document.querySelector('#controllType3'),
  controllType4 =       document.querySelector('#controllType4'),
];

var searchOptions = {
  attackType:       attackBar,
  defenseType:      defenseBar,
  sideStepType:     sideStepBar,
  invincibleType:   invincibleBar,
  createStarType:   createStarBar,
  starDropType:     starDropBar,
  starGatherBar:    starGatherBar,
  criticalType:     criticalBar,
  quickType:        quickBar,
  artsType:         artsBar,
  busterType:        busterBar,
  npChargeType:     npChargeBar,
  npUpType:         npUpBar,
  phantasmType:     phantasmBar,
  inflictDeathtYPE: inflictDeathBar,
  debuffType:       debuffBar,
  cleanseType:      cleanseBar,
  buffRemoveType:   buffRemoveBar,
  dotType:          dotBar,
  controllType:     controllBar,
};
const checkboxes = document.querySelectorAll('input[type=checkbox]');
const resultListCP =            document.querySelectorAll('.servant-icon');
const translateTable = {
  'attackType1': '加攻(自)',
  'attackType2': '加攻(单)',
  'attackType3': '加攻(全)',
  'defenseType1': '降防(单)',
  'defenseType2': '降防(全)',
  'defenseType3': '破防(自)',
  'defenseType4': '破防(单)',
  'defenseType5': '破防(全)',
  'sidestepType1': '闪避(自)',
  'sidestepType2': '闪避(单)',
  'sidestepType3': '闪避(全)',
  'sidestepType4': '必中(自)',
  'sidestepType5': '必中(单)',
  'sidestepType6': '必中(全)',
  'invincibleType1': '无敌(自)',
  'invincibleType2': '无敌(单)',
  'invincibleType3': '无敌(全)',
  'invincibleType4': '贯通(自)',
  'invincibleType5': '贯通(单)',
  'invincibleType6': '贯通(全)',
  'createStarType1': '产星',
  'createStarType2': '回合产星(自)',
  'createStarType3': '回合产星(单)',
  'createStarType4': '回合产星(全)',
  'starDropType1': '出星(自)',
  'starDropType2': '出星(单)',
  'starDropType3': '出星(全)',
  'starGatherType1': '集星(自)',
  'starGatherType2': '集星(单)',
  'starGatherType3': '集星(全)',
  'starGatherType4': '反集星(自)',
  'starGatherType5': '反集星(单)',
  'starGatherType6': '反集星(全)',
  'starGatherType7': '绿集星(自)',
  'starGatherType8': '绿集星(单)',
  'starGatherType9': '绿集星(全)',
  'starGatherType10': '蓝集星(自)',
  'starGatherType11': '蓝集星(单)',
  'starGatherType12': '蓝集星(全)',
  'starGatherType13': '红集星(自)',
  'starGatherType14': '红集星(单)',
  'starGatherType15': '红集星(全)',
  'criticalType1': '暴伤(自)',
  'criticalType2': '暴伤(单)',
  'criticalType3': '暴伤(全)',
  'criticalType4': '降暴耐(单)',
  'criticalType5': '降暴耐(全)',
  'quickType1': '绿放(自)',
  'quickType2': '绿放(单)',
  'quickType3': '绿放(全)',
  'quickType4': '降绿耐(单)',
  'quickType5': '降绿耐(全)',
  'artsType1': '蓝放(自)',
  'artsType2': '蓝放(单)',
  'artsType3': '蓝放(全)',
  'artsType4': '降蓝耐(单)',
  'artsType5': '降蓝耐(全)',
  'busterType1': '红放(自)',
  'busterType2': '红放(单)',
  'busterType3': '红放(全)',
  'busterType4': '降红耐(单)',
  'busterType5': '降红耐(全)',
  'npChargeType1': '充能(自)',
  'npChargeType2': '充能(单)',
  'npChargeType3': '充能(全)',
  'npChargeType4': '回合充能(自)',
  'npChargeType5': '回合充能(单)',
  'npChargeType6': '回合充能(全)',
  'npUpType1': '黄金律(自)',
  'npUpType2': '黄金律(单)',
  'npUpType3': '黄金律(全)',
  'npUpType4': '受伤黄金律(自)',
  'npUpType5': '受伤黄金律(单)',
  'npUpType6': '受伤黄金律(全)',
  'phantasmType1': '宝威(自)',
  'phantasmType2': '宝威(单)',
  'phantasmType3': '宝威(全)',
  'phantasmType4': '过充能(自)',
  'phantasmType5': '过充能(单)',
  'phantasmType6': '过充能(全)',
  'inflictDeathType1': '即死成功率提升(自)',
  'inflictDeathType2': '即死成功率提升(单)',
  'inflictDeathType3': '即死成功率提升(全)',
  'inflictDeathType4': '即死耐性下降(单)',
  'inflictDeathType5': '即死耐性下降(全)',
  'debuffType1': '弱化成功率提升(自)',
  'debuffType2': '弱化成功率提升(单)',
  'debuffType3': '弱化成功率提升(全)',
  'debuffType4': '弱化耐性下降(单)',
  'debuffType5': '弱化耐性下降(全)',
  'cleanseType1': '弱体解除(自)',
  'cleanseType2': '弱体解除(单)',
  'cleanseType3': '弱体解除(全)',
  'buffRemoveType1': '强化解除(单)',
  'buffRemoveType2': '强化解除(全)',
  'buffRemoveType3': '防御解除(单)',
  'buffRemoveType4': '防御解除(全)',
  'buffRemoveType5': '无敌解除(单)',
  'buffRemoveType6': '无敌解除(全)',
  'buffRemoveType7': '闪避解除(单)',
  'buffRemoveType8': '闪避解除(全)',
  'dotType1': '中毒',
  'dotType2': '诅咒',
  'dotType3': '灼伤',
  'dotType4': '蚀毒',
  'dotType5': '咒厄',
  'dotType6': '延烧',
  'controllType1': '眩晕',
  'controllType2': '魅惑',
  'controllType3': '猪化',
  'controllType4': '睡眠',
}
/**
 * --------------------------------------------------------------------------------------------------------------
 * search area settings
 * --------------------------------------------------------------------------------------------------------------
 */
const includeSkill =    document.querySelector('#includeSkill');
const includePhantasm = document.querySelector('#includePhantasm');
includeSkill.checked = true;
includeSkill.disabled = true;
includePhantasm.checked = false;
includePhantasm.disabled = false;

function fixSearchArea() {
  // if both skill and phantasm search are selected, enable uncheck for both checkbox
  if (includeSkill.checked && includePhantasm.checked) {
    includeSkill.disabled = false;
    includePhantasm.disabled = false;
  }
  // otherwise, enable the unchecked one but disable the checked one
  else if (includeSkill.checked) {
    includeSkill.disabled = true;
    includePhantasm.disabled = false;
  } else if (includePhantasm.checked) {
    includeSkill.disabled = false;
    includePhantasm.disabled = true;
  }
}
includeSkill.addEventListener('click', fixSearchArea);
includePhantasm.addEventListener('click', fixSearchArea);
/**
 * --------------------------------------------------------------------------------------------------------------
 * search button
 * --------------------------------------------------------------------------------------------------------------
 */
const SearchButton =    document.querySelector('.search-button');
function doPost() {
  resetResultListByOptions();
  // search key word list
  const keys = [];
  for(var key in searchOptions) {
    let subKey = searchOptions[key];
    for(let index in subKey) {
      if (subKey[index].checked) {
        keys.splice(0, 0, subKey[index].id);
      }
    }
  }
  adjustResultListByOption(keys);
}
SearchButton.addEventListener('click', doPost);
function adjustResultListByOption(OptionKeys) {
  if (OptionKeys.length > 0) {
    resultListCP.forEach(result => {
      let servantObj = servantList[(result.alt).slice(-3)];
      let satisfy = true;
      for(let idx = 0; idx < OptionKeys.length && satisfy; idx++) {
        if (includeSkill.checked && includePhantasm.checked) {
          if ((!servantObj.YY_PHANTASM_KEYS.includes(translateTable[OptionKeys[idx]]) &&
          !servantObj.ZZ_SKILL_KEYS.includes(translateTable[OptionKeys[idx]]))) {
            satisfy =  false;
          }
        } else if (includeSkill.checked && !servantObj.ZZ_SKILL_KEYS.includes(translateTable[OptionKeys[idx]])) {
          satisfy =  false;
        } else if (includePhantasm.checked && !servantObj.YY_PHANTASM_KEYS.includes(translateTable[OptionKeys[idx]])) {
          satisfy =  false;
        }
      }
      if (!satisfy) {
        result.classList.toggle('out-of-option', true);
      }
    });
  } else {
    resetResultListByOptions();
  }
  var resultList = document.querySelector('.result-list');
  resultList.scrollIntoView({behavior: 'smooth'});
}
function resetResultListByOptions() {
  let restoreList = document.querySelectorAll('.out-of-option');
  restoreList.forEach(result => {
    result.classList.toggle('out-of-option', false);
  });
}
/**
 * --------------------------------------------------------------------------------------------------------------
 * clear button
 * --------------------------------------------------------------------------------------------------------------
 */
const ClearButton =     document.querySelector('.clear-button');
function resetAll() {
  for(var key in searchOptions) {
    searchOptions[key].forEach(input => {
      input.checked = false;
    });
  }
  includeSkill.checked = true;
  includeSkill.disabled = true;
  includePhantasm.checked = false;
  includePhantasm.disabled = false;
}
ClearButton.addEventListener('click', resetAll);
resetAll();